<div class="heading">

  <div class="topRightBanner">
    <!--<span id="stationTime"></span>, <span id="stationDate"></span>-->
  </div>

  <div class="title">
    Meteo Fiobbio
  </div>
  <ul class="subTitle">
    <li>
      &#9650; <span id="stationElevation"></span>
    </li>
    <li> &nbsp;&#8211;&nbsp; </li>

    <li>
      <span id="stationLatitude"></span>&#8210;<span id="stationLongitude"></span>
    </li>
    <li> &nbsp;&#8211;&nbsp; </li>

    <li>
      &#9788;&UpperRightArrow;<span id="sunriseTime"></span>&nbsp;&LowerRightArrow;<span id="sunsetTime"></span>
    </li>
    <li> &nbsp;&#8211;&nbsp; </li>

    <li>
        &#9789; <span id="moonPhase"></span>
    </li>

  </ul>
  <!-- HEADER END -->
</div>

<div class="measures-container">
  <!-- NOTE: this is actually just a template, being used for the 2 containers below -->
  <ul id="measuresTemplate" class="measures-group" style="display: none;">
    <li class="">
      <!-- placeholder label to a correct flex layout -->
      <label class="emptyLabel">&nbsp;</label>
      <p class="location">XXXXXX</p>
      <p class="timestamp">TSSSSSS</p>
    </li>

    <li class="measure">
      <label>Temperatura (&deg;C)</label>
      <div>
        <div class="min">
          <div><span class="lowOutsideTemp"></span></div>
          <div class="sub"><span class="lowOutsideTempTime"></span></div>
        </div>
        <div class="curr">
          <span class="outsideTemp"></span>
          <span style="font-size: 50%;"> Feels&nbsp;</span><span style="font-size: 80%;" class="apparentTemp"></span>
        </div>
        <div class="max">
          <div><span class="hiOutsideTemp"></span></div>
          <div class="sub"><span class="hiOutsideTempTime"></span></div>
        </div>
      </div>
    </li>

    <li class="measure">
      <label>Vento (km/h)</label>
      <div>
        <div class="other">
          <div><span class="windGustSpeed"></span></div>
          <div class="sub">
            Raff
          </div>
        </div>
        <div class="curr">
          <span class="windSpeed"></span>
          <div style="font-size:50%">
            <span class="windDirection"></span>
          </div>
        </div>
        <div class="max">
          <div><span class="hiWindSpeed"></span></div>
          <div class="sub"><span class="hiWindSpeedTime"></span></div>
        </div>
      </div>
    </li>

    <li class="measure">
      <label>Umidit&agrave; (%)</label>
      <div>
        <div class="min">
          <div><span class="lowHumidity"></span></div>
          <div class="sub"><span class="lowHumTime"></span></div>
        </div>
        <div class="curr narrow">
          <span class="outsideHumidity"></span>
          <div style="font-size: 50%">&nbsp;</div>
        </div>
        <div class="max">
          <div><span class="hiHumidity"></span></div>
          <div class="sub"><span class="hiHumTime"></span></div>
        </div>
      </div>
    </li>

<!--
    <li class="measure">
      <label>Pressione</label>
      <div>
        <div class="min">
          <div><span class="lowBarometer"></span></div>
          <div class="sub"><span class="lowBarometerTime"></span></div>
        </div>
        <div class="curr">
          <span class="barometer"></span><label class="unit"><span class="barUnit"></span></label>
          <div style="font-size:50%">
            Tendenza&nbsp;<span class="baromtrend"></span>
          </div>
        </div>
        <div class="max">
          <div><span class="hiBarometer"></span></div>
          <div class="sub"><span class="hiBarometerTime"></span></div>
        </div>
      </div>
    </li>
-->

    <li class="measure">
      <label>Pioggia (mm/h)</label>
      <div>
        <div class="other">
          <div>
            <span class="dailyRain"></span>
          </div>
          <div class="sub">
            Accum
          </div>
        </div>
        <div class="curr">
          <span class="rainRate"></span>
          <div style="font-size:50%">
          </div>
        </div>
        <div class="max">
          <div>
            <span class="stormRain"></span>
          </div>
          <div class="sub">
            Storm
          </div>
        </div>
      </div>
    </li>
  </ul> <!-- measures-group -->

  <ul id="fiobbioMeasures" class="measures-group"></ul>
  <ul id="mismaMeasures" class="measures-group"></ul>

</div> <!-- <div class="measures-container"> -->

<div>
  <ul class="webcams-container">
    <li>
      <a href="http://rete.centrometeolombardo.com/bergamo/fiobbio/public/webcam.jpg" data-featherlight="image">
        <img class="webcam" alt="webcam_small" src="http://rete.centrometeolombardo.com/bergamo/fiobbio/public/webcam_small.jpg" />
      </a>
    </li>
    <li>
      <a href="http://rete.centrometeolombardo.com/bergamo/montemisma/public/webcam.jpg" data-featherlight="image">
        <img class="webcam" alt="webcam_small" src="http://rete.centrometeolombardo.com/bergamo/montemisma/public/webcam_small.jpg" />
      </a>
    </li>
  </ul>
</div>

<!-- credits: https://css-tricks.com/infinite-all-css-scrolling-slideshow/ -->
<div class="panorama-scroll" style="display:none;">
  <!-- <div class="sliding-background"></div> -->
  <div class="still-background"></div>
</div>

<div>
  <ul class="graph-container">
    <li>
      <img class="wviewgraph" alt="wview image" src="tempdaycomp.png">
    </li>
    <li>
      <img alt="wview image" src="wspeeddaycomp.png">
    </li>
    <li>
      <img alt="wview image" src="radiationDay.png ">
    </li>
  </ul>

  <ul class="graph-container">
    <li>
      <img alt="wview image" src="rainday.png">
    </li>
    <li>
      <img alt="wview image" src="baromday.png">
    </li>
    <li>
      <img alt="wview image" src="humidday.png">
    </li>
  </ul>

  <!-- All radiation + rain -->
  <ul class="graph-container" style="display:none;">
    <li>
      <img class="wviewbar" alt="wview image" src="radiation.png">
    </li>
    <li>
      <img class="wviewbar" alt="wview image" src="dayrain.png">
    </li>
    <li>
      <img class="wviewbar" alt="wview image" src="stormrain.png">
    </li>
    <li>
      <img class="wviewbar" alt="wview image" src="rainrate.png">
    </li>
    <li>
      <img class="wviewbar" alt="wview image" src="monthrain.png">
    </li>
    <li>
      <img class="wviewbar" alt="wview image" src="yearrain.png">
    </li>
  </ul>

  <!-- All wind -->
  <ul class="graph-container" style="display:none;">
    <li>
      <img class="round" alt="wview image" src="windroseday.png">
    </li>
    <li>
      <img class="round" alt="wview image" src="windroseweek.png">
    </li>
    <li>
      <img class="round" alt="wview image" src="windroseyear.png">
    </li>
  </ul>

  <!-- Wind / rain mix -->
  <ul class="graph-container">
    <li>
      <img class="round" alt="wview image" src="windroseday.png">
    </li>

    <li>
      <img class="wviewbar" alt="wview image" src="dayrain.png">
    </li>
    <li>
      <img class="wviewbar" alt="wview image" src="monthrain.png">
    </li>
    <li>
      <img class="wviewbar" alt="wview image" src="yearrain.png">
    </li>


    <li>
      <img class="round" alt="wview image" src="windroseyear.png">
    </li>
  </ul>

  <!-- grafana iframe -->
  <ul class="graph-container">
    <li>
      <iframe class="grafana-chart" src="http://so.sba.lat/d-solo/WC0xr_dGz/meteo?orgId=1&var-job=meteo-fiobbio&panelId=31"></iframe>
    </li>
  </ul>
  <ul class="graph-container">
    <li>
      <iframe class="grafana-chart" src="http://so.sba.lat/d-solo/WC0xr_dGz/meteo?orgId=1&var-job=meteo-fiobbio&panelId=33"></iframe>
    </li>
  </ul>

</div>
<!-- WEATHER IMAGES END -->

<script>
  $(() => {

    function populateStationInfo() {
        $.ajax({
          url      : "stationinfo.json",
          dataType : "json"
        }).done( (jsonData) => {

          // we map 1:1 json key value with id name,
          // so that jsonData loading is trivial!
          $.each(jsonData, (key, val) => {
            $("#" + key).text(val);
          });
        });
    }

    function isToday(dateString) {
      let today = new Date();
      let dateTokens = dateString.split('/');

      let dd = parseInt(dateTokens[0]);
      let mm = parseInt(dateTokens[1]);
      let yy = parseInt(dateTokens[2]);

      return (today.getDate() == dd &&
              (today.getMonth() + 1) == mm &&
              (today.getFullYear() % 100) == yy);
    }

    function populateMeasures(locs) {

      locs.forEach((loc) => {
        $.ajax({

          url      : loc.url,
          dataType : "json"

        }).done( (jsonData) => {

          // Copy the HTML template into the actual element ID with the given tgtId
          $("#" + loc.tgtId).html($("#measuresTemplate").html());

          $("#" + loc.tgtId + " .location").text(loc.location);

          // Strip out seconds
          jsonData.timestamp = jsonData.stationTime.split(':', 2).join(':');

          // if not today, append full date
          if (!isToday(jsonData.stationDate)) {
            jsonData.timestamp += ' - ' + jsonData.stationDate;
          }

          // we map 1:1 json key value with id name,
          // so that jsonData loading is trivial!
          $.each(jsonData, (key, val) => {
            $("#" + loc.tgtId + " ." + key).text(val);
          });

        }); // ajax..done

      }); // forEach
    }

    $(document).ready(() => {
      const locations = [
        {
          url   : "realtime.json" ,
          tgtId : "fiobbioMeasures",
          location : "Paese"
        },
        {
          url   : "/misma/realtime.json",
          tgtId : "mismaMeasures",
          location : "Misma"
        }
      ];

      populateStationInfo();
      populateMeasures(locations);

    });

  });
</script>
