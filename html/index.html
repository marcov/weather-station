<t!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Meteo, Webcam e Previsioni Fiobbio di Albino</title>
  <meta name="description"
     content="Dati in tempo reale delle stazioni meteo di Fiobbio di Albino e
              del Monte Misma.
              Immagini in diretta webcam Fiobbio di Albino.
              Immagini in diretta webcam Monte Misma.
              Previsioni meteo per Albino (BG).
              Archivio dati meteo di Albino.
              Fiobbio Ã¨ un paese situato nella Valle del Lujo,
              nella media Val Seriana, in provincia di Bergamo, Lombardia. ">

  <!-- the following is needed for the media queries to work correctly -->
  <meta name="viewport" content="width=device-width">

  <link type="text/css" rel="stylesheet" href="css/layout.css" />

  <link type="text/css" rel="stylesheet" href="css/lightbox.css" />

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Inconsolata|Major+Mono+Display|Share+Tech+Mono|Oxygen+Mono|Baloo+Tamma+2:wght@400;700;800">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KCSTMYF26E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-KCSTMYF26E');
  </script>

  <!-- AdSense
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8303716244658891"
     crossorigin="anonymous"></script>
  -->
</head>

<body>
  <div class="maincolumn">

    <div class="heading">
      <ul>
          <li class="title"> <h1>Meteo Fiobbio </h1></li>
      </ul>

      <p class="heading-separator"> | </p>

      <ul class="links">
        <li>
        <a href="/grafana/d/Ewu-ii3Mk/wview-all-stations?orgId=1&kiosk=tv">Dettagli</a>
        </li>
        <li> &nbsp;&#8211;&nbsp; </li>
        <li>
        <a href="/grafana/d/-qh9KGzRk/wview-past-years-comparison--and-misma?orgId=1&kiosk=tv">Serie Storiche</a>
        </li>
        <li> &nbsp;&#8211;&nbsp; </li>
        <a href="archive.html" class="indented">Archivio</a>
        </li>
        <li> &nbsp;&#8211;&nbsp; </li>
        <li>
        <a href="mailto:marcelloalborghetti@gmail.com,marco.vedovati@gmail.com">Contatti</a>
        </li>
        <!--
        <a href="/fiobbio2">Fiobbio 2</a>
        &nbsp;&#8211;&nbsp;
        <a href="/misma">Mt. Misma</a>
        &nbsp;&#8211;&nbsp;
        <a href="almanac.htm" class="indented">Almanacco</a>
        &nbsp;&#8211;&nbsp;
        <a href="Daily.htm" class="indented">24h</a>
        &nbsp;&#8211;&nbsp;
        <a href="Monthly.htm" class="indented">Mese in corso</a>
        &nbsp;&#8211;&nbsp;
        <a href="Yearly.htm" class="indented">Anno in corso</a>
        &nbsp;&#8211;&nbsp;
        -->
      </ul>

      <p class="heading-separator"> | </p>

      <ul class="stationData">
        <li> &#9650; <span id="stationElevation"></span> </li>
        <li> &nbsp;&#8211;&nbsp; </li>

        <li>
          <span id="stationLatitude"></span>&#8210;<span id="stationLongitude"></span>
        </li>
        <li> &nbsp;&#8211;&nbsp; </li>

        <li>
          &UpperRightArrow;<span id="sunriseTime"></span>&nbsp;&LowerRightArrow;<span id="sunsetTime"></span>
        </li>
        <li> &nbsp;&#8211;&nbsp; </li>

        <li>
            &#9789; <span id="moonPhase"></span>
        </li>
      </ul>

    </div>

    <div class="measures-container">
      <!-- NOTE: this is actually just a template, being used for the 2 containers below -->
      <ul id="measuresTemplate" class="measures-group" style="display: none;">

        <li class="" style="min-width: 10rem;">
          <!-- placeholder label to a correct flex layout -->
          <label class="emptyLabel">&nbsp;</label>
          <div>
              <a class="location"></a>&nbsp;-&nbsp;<label class="timestamp"></label>
          </div>
        </li>

        <li class="measure">
          <label>Temperatura (&deg;C)</label>
          <div>
            <div class="min">
              <div><span class="lowOutsideTemp"></span></div>
              <div class="sub"><span class="lowOutsideTempTime"></span></div>
            </div>
            <div class="curr tempCurr">
              <span class="outsideTemp"></span>
              <span style="font-size: 50%;"> Feels&nbsp;</span><span style="font-size: 60%;" class="apparentTemp"></span>
            </div>
            <div class="max">
              <div><span class="hiOutsideTemp"></span></div>
              <div class="sub"><span class="hiOutsideTempTime"></span></div>
            </div>
          </div>
        </li>

        <li class="measure">
          <label>Vento (km/h)</label>
          <div>
            <div class="other">
              <div><span class="windGustSpeed"></span></div>
              <div class="sub">
                Raff
              </div>
            </div>
            <div class="curr">
              <span class="windSpeed"></span>
              <div class="sub" style="font-size:50%">
              Dir <span class="windDirection"></span>
              </div>
            </div>
            <div class="max">
              <div><span class="hiWindSpeed"></span></div>
              <div class="sub"><span class="hiWindSpeedTime"></span></div>
            </div>
          </div>
        </li>

        <li class="measure">
          <label>Umidit&agrave; (%)</label>
          <div>
            <div class="min">
              <div><span class="lowHumidity"></span></div>
              <div class="sub"><span class="lowHumTime"></span></div>
            </div>
            <div class="curr narrow">
              <span class="outsideHumidity"></span>
              <div style="font-size: 50%">&nbsp;</div>
            </div>
            <div class="max">
              <div><span class="hiHumidity"></span></div>
              <div class="sub"><span class="hiHumTime"></span></div>
            </div>
          </div>
        </li>

    <!--
        <li class="measure">
          <label>Pressione</label>
          <div>
            <div class="min">
              <div><span class="lowBarometer"></span></div>
              <div class="sub"><span class="lowBarometerTime"></span></div>
            </div>
            <div class="curr">
              <span class="barometer"></span><label class="unit"><span class="barUnit"></span></label>
              <div style="font-size:50%">
                Tendenza&nbsp;<span class="baromtrend"></span>
              </div>
            </div>
            <div class="max">
              <div><span class="hiBarometer"></span></div>
              <div class="sub"><span class="hiBarometerTime"></span></div>
            </div>
          </div>
        </li>
    -->

        <li class="measure">
          <label>Pioggia (mm/h)</label>
          <div>
            <div class="other">
              <div>
                <span class="dailyRain"></span>
              </div>
              <div class="sub">
                Giorn
              </div>
            </div>
            <div class="curr">
              <span class="rainRate"></span>
              <div style="font-size:50%">
              </div>
            </div>
            <div class="max">
              <div>
                <span class="stormRain"></span>
              </div>
              <div class="sub">
                Max Int
              </div>
            </div>
          </div>
        </li>
      </ul> <!-- measures-group -->

      <ul id="fiobbio1Measures" class="measures-group"></ul>
      <ul id="fiobbio2Measures" class="measures-group"></ul>
      <ul id="mismaMeasures" class="measures-group"></ul>

    </div> <!-- <div class="measures-container"> -->

    <!-- Lightbox with zoom images -- NOTE: this is not visible -->
    <div class="lightbox">
      <div class="lightbox-content">
        <button class="close-button">&times;</button>
        <img class="zoom-img" src="" alt="Zoomed Image" />
        <button class="nav-button prev-button">&lt;</button>
        <button class="nav-button next-button">&gt;</button>
      </div>
    </div>

    <div>
      <ul class="webcams-container gallery">
        <div class="gallery-item" data-full-img="/webcam/webcam_fiobbio.jpg">
          <img class="preview-img" src="/webcam/webcam_small_fiobbio.jpg" alt="Sample 1" />
        </div>
        <div class="gallery-item" data-full-img="/webcam/webcam_misma.jpg">
          <img class="preview-img" src="/webcam/webcam_small_misma.jpg" alt="Sample 2" />
        </div>
      </ul>
    </div>

    <div>
      <ul class="graph-container">
        <li> <img class="wviewgraph" alt="wview image" src="/fiobbio1/daytempdew.png"> </li>
        <li> <img alt="wview image" src="/fiobbio1/daywind.png"> </li>
        <li> <img alt="wview image" src="/fiobbio1/dayradiation.png "> </li>
      </ul>

      <ul class="graph-container">
        <li>
          <img alt="wview image" src="/fiobbio1/rainday.png">
        </li>
        <li>
          <img alt="wview image" src="/fiobbio1/baromday.png">
        </li>
        <li>
          <img alt="wview image" src="/fiobbio1/humidday.png">
        </li>
      </ul>

      <!-- Wind / rain mix -->
      <ul class="graph-container">
        <li>
          <img class="wviewbar" alt="wview image" src="/downloader/rain_day.png">
        </li>

        <li>
          <img class="wviewbar" alt="wview image" src="/downloader/rain_month.png">
        </li>

        <li>
          <img class="wviewbar" alt="wview image" src="/downloader/rain_year.png">
        </li>

      </ul>

    </div>
    <!-- WEATHER IMAGES END -->

    <div>
        <div class="bottombanner">
          <span style="font-weight: bold;">Marcello Alborghetti</span>
          <span style="font-size:80%;">&nbsp;(HW)&nbsp; - &nbsp;</span>
          <span style="font-weight: bold; font-size:102%; letter-spacing:.15rem;">Marco Vedovati</span>
          <span style="font-size:80%;">&nbsp;(SW)</span>
        </div>
    </div>

    <h3>Previsioni Meteo</h3>
    <ul class="flex-container">
      <li>
        <a href="https://www.meteoblue.com/en/weather/week/albino_italy_3183316/" title="Large image">
          <img style="height: 15em;" src="/webshot/meteoblue.jpg" alt="Meteoblue 7 days" title="Meteoblue 7 days" />
        </a>
      </li>
    </ul>

    <ul class="flex-container">
      <li>
        <a href="https://www.wetterzentrale.de/en/show_diagrams.php?geoid=76406&model=ecm&var=93&run=0&lid=OP&bw=" title="Large image">
          <img class="forecast-img" src="/webshot/wz_meteogram.jpg" alt="Meteogram 10d wetterzentrale" title="Meteogram 10d" />
        </a>
      </li>

      <li>
        <a href="https://www.wetterzentrale.de/en/show_diagrams.php?geoid=76406&model=ecm&var=201&run=12&lid=ENS&bw=" title="Large image">
          <img class="forecast-img" src="/webshot/wz_ensemble.jpg" alt="Meteogram 10d wetterzentrale" title="Ensemble 10d" />
        </a>
      </li>
    </ul>

    <h3>Immagini Satellitari</h3>
    <ul class="flex-container gallery">

      <div class="gallery-item" data-full-img="/downloader/sat_alps.jpg">
        <img class="preview-img" src="/downloader/sat_alps.jpg" alt="sat24.com" />
      </div>

      <div class="gallery-item" data-full-img="https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSG_RGBNatColour_CentralEurope.jpg">
        <img class="preview-img" src="https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSG_RGBNatColour_CentralEurope.jpg" alt="eumetsat.org" />
      </div>

    </ul>

    <h3>Radar Meteo</h3>
    <ul class="flex-container gallery">

      <div class="gallery-item" data-full-img="/webshot/radar_lom.jpg">
        <img class="preview-img" src="/webshot/radar_lom.jpg" alt="Radar CML" />
      </div>

      <div class="gallery-item" data-full-img="https://www.astrogeo.va.it/fulmini/fulmini.jpg">
        <img class="preview-img" src="https://www.astrogeo.va.it/fulmini/fulmini.jpg" alt="Mappa Fulmini" />
      </div>

    </ul>

  </div> <!-- div..maincolumn -->

  <script>
    function isToday(dateString) {
        let today = new Date();
        let dateTokens = dateString.split('/');

        let dd = parseInt(dateTokens[0]);
        let mm = parseInt(dateTokens[1]);
        let yy = parseInt(dateTokens[2]);

        return (today.getDate() == dd &&
                (today.getMonth() + 1) == mm &&
                (today.getFullYear() % 100) == yy);
    }

    function populateStationInfo() {
        fetch('/fiobbio1/stationinfo.json')
            .then(response => response.json())
            .then(jsonData => {
                // Loop through each property in the JSON data
                Object.entries(jsonData).forEach(([key, value]) => {
                    // Find element by ID and update its text content
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = value;
                    }
                });
            })
            .catch(error => console.error('Error loading station info:', error));
    }

    function populateMeasures(locs) {
        locs.forEach((loc) => {
            fetch(loc.Path + "realtime.json")
                .then(response => response.json())
                .then(jsonData => {
                    // Get the target element and template
                    const targetElement = document.getElementById(loc.tgtId);
                    const template = document.getElementById('measuresTemplate');

                    // Copy template content
                    targetElement.innerHTML = template.innerHTML;

                    // Update location elements
                    const locationElement = targetElement.querySelector('.location');
                    locationElement.textContent = loc.location;
                    locationElement.href = loc.Path;

                    // Strip out seconds from timestamp
                    jsonData.timestamp = jsonData.stationTime.split(':', 2).join(':');

                    // if not today, append full date
                    if (!isToday(jsonData.stationDate)) {
                        jsonData.timestamp += ' - ' + jsonData.stationDate;
                    }

                    // Update all matching elements with JSON data
                    // we map 1:1 json key value with id name,
                    // so that jsonData loading is trivial
                    Object.entries(jsonData).forEach(([key, val]) => {
                        const element = targetElement.querySelector('.' + key);
                        if (element) {
                            element.textContent = val;
                            // if (key === 'timestamp') {
                            //     element.style.backgroundColor = 'green';
                            // }
                        }
                    });
                })
                .catch(error => console.error('Error loading data for location:', loc.location, error));
        });
    }

    const locations = [
      {
        Path   : "/fiobbio1/",
        tgtId : "fiobbio1Measures",
        location : "Fiobbio 1"
      },
      {
        Path   : "/misma/",
        tgtId : "mismaMeasures",
        location : "Misma"
      },
      {
        Path   : "/fiobbio2/",
        tgtId : "fiobbio2Measures",
        location : "Fiobbio 2"
      }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        populateStationInfo();
        populateMeasures(locations);
    }); /* document.addEventListener('DOMContentLoaded', () => { */

    class Lightbox {
      constructor() {
        this.lightbox = document.querySelector('.lightbox');
        this.zoomImg = this.lightbox.querySelector('.zoom-img');
        this.galleries = document.querySelectorAll('.gallery');

        this.currentGallery = null;
        this.currentItems = [];
        this.currentIndex = 0;

        this.init();
      }

      init() {
        // Initialize each gallery
        this.galleries.forEach(gallery => {
          const items = Array.from(gallery.querySelectorAll('.gallery-item'));

          items.forEach((item, index) => {
            item.addEventListener('click', () => {
              // Set current gallery context
              this.currentGallery = gallery;
              this.currentItems = items;
              this.currentIndex = index;

              const fullImgSrc = item.getAttribute('data-full-img');
              this.showLightbox(fullImgSrc);
            });
          });
        });

        // Close button
        this.lightbox.querySelector('.close-button').addEventListener('click', () => {
          this.hideLightbox();
        });

        // Navigation buttons
        this.lightbox.querySelector('.prev-button').addEventListener('click', () => {
          this.navigate(-1);
        });

        this.lightbox.querySelector('.next-button').addEventListener('click', () => {
          this.navigate(1);
        });

        // Close on background click
        this.lightbox.addEventListener('click', (e) => {
          if (e.target === this.lightbox) {
            this.hideLightbox();
          }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
          if (!this.lightbox.classList.contains('active')) return;

          switch(e.key) {
            case 'Escape':
              this.hideLightbox();
              break;
            case 'ArrowLeft':
              this.navigate(-1);
              break;
            case 'ArrowRight':
              this.navigate(1);
              break;
          }
        });
      }

      showLightbox(src) {
        // Preload the image
        const img = new Image();
        img.onload = () => {
          this.zoomImg.src = src;
          this.lightbox.classList.add('active');
          document.body.style.overflow = 'hidden';
        };
        img.src = src;
      }

      hideLightbox() {
        this.lightbox.classList.remove('active');
        document.body.style.overflow = '';
      }

      navigate(direction) {
        this.currentIndex = (this.currentIndex + direction + this.currentItems.length) % this.currentItems.length;
        const nextImgSrc = this.currentItems[this.currentIndex].getAttribute('data-full-img');
        this.showLightbox(nextImgSrc);
      }
    }

    // Initialize the lightbox
    document.addEventListener('DOMContentLoaded', () => {
      new Lightbox();
    });

  </script>

</body>

</html>
